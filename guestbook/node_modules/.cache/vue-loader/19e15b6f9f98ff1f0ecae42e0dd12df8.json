{"remainingRequest":"D:\\devel\\GuestBook\\guestbook\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\devel\\GuestBook\\guestbook\\src\\components\\Messages.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\devel\\GuestBook\\guestbook\\src\\components\\Messages.vue","mtime":1595860508850},{"path":"D:\\devel\\GuestBook\\guestbook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\devel\\GuestBook\\guestbook\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\devel\\GuestBook\\guestbook\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\devel\\GuestBook\\guestbook\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJNZXNzYWdlcyIsDQoNCiAgcHJvcHM6IFsicGFnZU51bWJlciIsICJzb3J0Q29sdW1uIiwgImRlc2NlbmRpbmdPcmRlciJdLA0KDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIC8vIEVsZW1lbnQgcmVzaXppbmcNCiAgICAgIHRvb2xCYXJIZWlnaHQ6IHVuZGVmaW5lZCwNCiAgICAgIHdpbmRvd0hlaWdodDogMCwNCg0KICAgICAgcGFnZTogMSwNCiAgICAgIGhlYWRlcnM6IFsNCiAgICAgICAgew0KICAgICAgICAgIHRleHQ6ICIiLA0KICAgICAgICAgIGFsaWduOiAiY2VudGVyIiwNCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsDQogICAgICAgICAgdmFsdWU6ICJpbmRleCIsDQogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIHRleHQ6ICLQlNCw0YLQsCDQtNC+0LHQsNCy0LvQtdC90LjRjyIsDQogICAgICAgICAgYWxpZ246ICJjZW50ZXIiLA0KICAgICAgICAgIHNvcnRhYmxlOiB0cnVlLA0KICAgICAgICAgIHZhbHVlOiAiZGF0ZUMiLA0KICAgICAgICAgIGRpdmlkZXI6IHRydWUsDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICB0ZXh0OiAi0JjQvNGPINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyIsDQogICAgICAgICAgYWxpZ246ICJzdGFydCIsDQogICAgICAgICAgc29ydGFibGU6IHRydWUsDQogICAgICAgICAgdmFsdWU6ICJ1c2VyTmFtZSIsDQogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIHRleHQ6ICJFLW1haWwiLA0KICAgICAgICAgIGFsaWduOiAic3RhcnQiLA0KICAgICAgICAgIHNvcnRhYmxlOiB0cnVlLA0KICAgICAgICAgIHZhbHVlOiAiZW1haWwiLA0KICAgICAgICAgIGRpdmlkZXI6IHRydWUsDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICB0ZXh0OiAi0KLQtdC60YHRgiIsDQogICAgICAgICAgYWxpZ246ICJzdGFydCIsDQogICAgICAgICAgc29ydGFibGU6IGZhbHNlLA0KICAgICAgICAgIHZhbHVlOiAidGV4dCIsDQogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwNCiAgICAgICAgfSwNCiAgICAgIF0sDQogICAgICBtZXNzYWdlTGlzdDogW10sDQogICAgICByb3dzQ291bnQ6IDAsDQogICAgICByb3dzUGVyUGFnZTogMjUsDQogICAgICBvcHRpb25zOiB7IG11c3RTb3J0OiB0cnVlIH0sDQogICAgICBsb2FkaW5nOiBmYWxzZSwNCiAgICB9Ow0KICB9LA0KICBjb21wdXRlZDogew0KICAgIHRhYmxlSGVpZ2h0KCkgew0KICAgICAgaWYgKHRoaXMudG9vbEJhckhlaWdodCAhPT0gdW5kZWZpbmVkKQ0KICAgICAgICByZXR1cm4gdGhpcy53aW5kb3dIZWlnaHQgLSB0aGlzLnRvb2xCYXJIZWlnaHQgLSA1OTsNCiAgICAgIHJldHVybiB1bmRlZmluZWQ7DQogICAgfSwNCiAgICBpc1hTKCkgew0KICAgICAgcmV0dXJuIHRoaXMuJHZ1ZXRpZnkuYnJlYWtwb2ludC54czsNCiAgICB9LA0KDQogICAgY3JlYXRlTWVzc2FnZVBhdGgoKSB7DQogICAgICByZXR1cm4gKA0KICAgICAgICAiL2NyZWF0ZS1tZXNzYWdlLyIgKw0KICAgICAgICB0aGlzLnBhZ2luZyh0aGlzLnBhZ2VOdW1iZXIsIHRoaXMuc29ydENvbHVtbiwgdGhpcy5kZXNjZW5kaW5nT3JkZXIpDQogICAgICApOw0KICAgIH0sDQoNCiAgICBwYWdlQ291bnQoKSB7DQogICAgICBpZiAodGhpcy5yb3dzQ291bnQgPiAwKQ0KICAgICAgICByZXR1cm4gTWF0aC5jZWlsKHRoaXMucm93c0NvdW50IC8gdGhpcy5yb3dzUGVyUGFnZSk7DQogICAgICBlbHNlIHJldHVybiAxOw0KICAgIH0sDQoNCiAgICBpc0Rlc2NlbmRpbmdPcmRlcigpIHsNCiAgICAgIHJldHVybiB0aGlzLmRlc2NlbmRpbmdPcmRlciA9PSAidHJ1ZSINCiAgICAgICAgPyB0cnVlDQogICAgICAgIDogdGhpcy5kZXNjZW5kaW5nT3JkZXIgPT0gImZhbHNlIg0KICAgICAgICA/IGZhbHNlDQogICAgICAgIDogdW5kZWZpbmVkOw0KICAgIH0sDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBoYW5kbGVXaW5kb3dSZXNpemUoKSB7DQogICAgICB0aGlzLndpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsNCiAgICB9LA0KICAgIHBhZ2luZyhwYWdlTnVtYmVyLCBzb3J0Q29sdW1uLCBkZXNjZW5kaW5nT3JkZXIpIHsNCiAgICAgIHJldHVybiBwYWdlTnVtYmVyICsgIiYiICsgc29ydENvbHVtbiArICImIiArIGRlc2NlbmRpbmdPcmRlcjsNCiAgICB9LA0KDQogICAgbG9jYWxlRGF0ZVRpbWVTdHJpbmcoZGF0ZSkgew0KICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvTG9jYWxlU3RyaW5nKCk7DQogICAgfSwNCg0KICAgIGxvYWRNZXNzYWdlTGlzdCgpIHsNCiAgICAgIGxldCBvcHRpb25zID0gew0KICAgICAgICBQYWdlTnVtYmVyOiBOdW1iZXIodGhpcy5wYWdlTnVtYmVyKSwNCiAgICAgICAgUGFnZVNpemU6IHRoaXMucm93c1BlclBhZ2UsDQogICAgICAgIFNvcnRDb2x1bW46IHRoaXMuc29ydENvbHVtbiwNCiAgICAgICAgRGVzY2VuZGluZ09yZGVyOiB0aGlzLmlzRGVzY2VuZGluZ09yZGVyLA0KICAgICAgfTsNCg0KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsNCiAgICAgIHRoaXMuJHN0b3JlDQogICAgICAgIC5kaXNwYXRjaCgibWVzc2FnZXMvZ2V0TWVzc2FnZXMiLCBvcHRpb25zKQ0KICAgICAgICAudGhlbigocmVzcG9uY2UpID0+IHsNCiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgICB0aGlzLm1lc3NhZ2VMaXN0ID0gcmVzcG9uY2UuZGF0YS5tZXNzYWdlTGlzdDsNCiAgICAgICAgICB0aGlzLnJvd3NDb3VudCA9IHJlc3BvbmNlLmRhdGEucm93c0NvdW50Ow0KICAgICAgICAgIHRoaXMub3B0aW9ucy5wYWdlID0gb3B0aW9ucy5QYWdlTnVtYmVyOw0KICAgICAgICAgIHRoaXMucGFnZSA9IG9wdGlvbnMuUGFnZU51bWJlcjsNCiAgICAgICAgICB0aGlzLm9wdGlvbnMuc29ydEJ5ID0gW29wdGlvbnMuU29ydENvbHVtbl07DQogICAgICAgICAgdGhpcy5vcHRpb25zLnNvcnREZXNjID0gW29wdGlvbnMuRGVzY2VuZGluZ09yZGVyXTsNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgfSk7DQogICAgfSwNCg0KICAgIHBhZ2VDbGlja2VkKHBhZ2UpIHsNCiAgICAgIGlmICh0aGlzLnBhZ2UgIT09IHBhZ2UpIHsNCiAgICAgICAgdGhpcy4kcm91dGVyDQogICAgICAgICAgLnB1c2goDQogICAgICAgICAgICAiL21lc3NhZ2VzLyIgKw0KICAgICAgICAgICAgICB0aGlzLnBhZ2luZyhwYWdlLCB0aGlzLnNvcnRDb2x1bW4sIHRoaXMuZGVzY2VuZGluZ09yZGVyKQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICB0aGlzLmxvYWRNZXNzYWdlTGlzdCgpOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKCgpID0+IHt9KTsNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KICB3YXRjaDogew0KICAgIG9wdGlvbnM6IGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmICgNCiAgICAgICAgdGhpcy5vcHRpb25zLnNvcnRCeVswXSAmJg0KICAgICAgICB0aGlzLm9wdGlvbnMuc29ydERlc2NbMF0gIT09IHVuZGVmaW5lZCAmJg0KICAgICAgICAodGhpcy5vcHRpb25zLnNvcnRCeVswXSAhPT0gdGhpcy5zb3J0Q29sdW1uIHx8DQogICAgICAgICAgdGhpcy5vcHRpb25zLnNvcnREZXNjWzBdICE9PSB0aGlzLmlzRGVzY2VuZGluZ09yZGVyKQ0KICAgICAgKSB7DQogICAgICAgIHRoaXMuJHJvdXRlcg0KICAgICAgICAgIC5wdXNoKA0KICAgICAgICAgICAgIi9tZXNzYWdlcy8iICsNCiAgICAgICAgICAgICAgdGhpcy5wYWdpbmcoMSwgdGhpcy5vcHRpb25zLnNvcnRCeVswXSwgdGhpcy5vcHRpb25zLnNvcnREZXNjWzBdKQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICB0aGlzLmxvYWRNZXNzYWdlTGlzdCgpOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKCgpID0+IHt9KTsNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KICBkZXN0cm95ZWQoKSB7DQogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIHRoaXMuaGFuZGxlV2luZG93UmVzaXplKTsNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgdGhpcy5oYW5kbGVXaW5kb3dSZXNpemUpOw0KICAgIHRoaXMuaGFuZGxlV2luZG93UmVzaXplKCk7DQogICAgdGhpcy50b29sQmFySGVpZ2h0ID0gdGhpcy4kcmVmcy5tc2dMaXN0VG9vbGJhci5jb21wdXRlZENvbnRlbnRIZWlnaHQ7DQoNCiAgICBpZiAoDQogICAgICAhTnVtYmVyLmlzU2FmZUludGVnZXIoTnVtYmVyKHRoaXMucGFnZU51bWJlcikpIHx8DQogICAgICAhdGhpcy5oZWFkZXJzLmZpbmQoKGl0ZW0pID0+IGl0ZW0udmFsdWUgPT09IHRoaXMuc29ydENvbHVtbikgfHwNCiAgICAgIHRoaXMuaXNEZXNjZW5kaW5nT3JkZXIgPT09IHVuZGVmaW5lZA0KICAgICkgew0KICAgICAgdGhpcy4kcm91dGVyDQogICAgICAgIC5wdXNoKCIvbWVzc2FnZXMvIiArIHRoaXMucGFnaW5nKDEsICJ1c2VyTmFtZSIsIGZhbHNlKSkNCiAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgIHRoaXMubG9hZE1lc3NhZ2VMaXN0KCk7DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaCgoKSA9PiB7fSk7DQogICAgfSBlbHNlIHRoaXMubG9hZE1lc3NhZ2VMaXN0KCk7DQogIH0sDQp9Ow0K"},{"version":3,"sources":["Messages.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Messages.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <v-card dark flat class=\"fill-height\" tile>\r\n    <v-toolbar ref=\"msgListToolbar\" color=\"primary\" dense flat>\r\n      <v-toolbar-title>Список сообщений</v-toolbar-title>\r\n      <v-spacer />\r\n      <v-btn :icon=\"isXS\" :to=\"createMessagePath\" text>\r\n        <v-icon :left=\"!isXS\">mdi-pen</v-icon>\r\n        {{isXS ? '' : 'Добавить сообщение'}}\r\n      </v-btn>\r\n    </v-toolbar>\r\n    <v-data-table\r\n      :height=\"tableHeight\"\r\n      :headers=\"headers\"\r\n      :items=\"messageList\"\r\n      :server-items-length=\"rowsCount\"\r\n      :options.sync=\"options\"\r\n      :loading=\"loading\"\r\n      hide-default-footer\r\n      dense\r\n    >\r\n      <template\r\n        v-slot:item.index=\"{ item }\"\r\n      >{{(page - 1) * rowsPerPage + messageList.indexOf(item) + 1}}</template>\r\n      <template v-slot:item.dateC=\"{ item }\">{{localeDateTimeString(item.dateC)}}</template>\r\n      <template v-slot:item.text=\"{ item }\">{{decodeURI(item.text)}}</template>\r\n    </v-data-table>\r\n    <v-pagination :value=\"page\" :length=\"pageCount\" @input=\"pageClicked($event)\" />\r\n  </v-card>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Messages\",\r\n\r\n  props: [\"pageNumber\", \"sortColumn\", \"descendingOrder\"],\r\n\r\n  data() {\r\n    return {\r\n      // Element resizing\r\n      toolBarHeight: undefined,\r\n      windowHeight: 0,\r\n\r\n      page: 1,\r\n      headers: [\r\n        {\r\n          text: \"\",\r\n          align: \"center\",\r\n          sortable: false,\r\n          value: \"index\",\r\n          divider: true,\r\n        },\r\n        {\r\n          text: \"Дата добавления\",\r\n          align: \"center\",\r\n          sortable: true,\r\n          value: \"dateC\",\r\n          divider: true,\r\n        },\r\n        {\r\n          text: \"Имя пользователя\",\r\n          align: \"start\",\r\n          sortable: true,\r\n          value: \"userName\",\r\n          divider: true,\r\n        },\r\n        {\r\n          text: \"E-mail\",\r\n          align: \"start\",\r\n          sortable: true,\r\n          value: \"email\",\r\n          divider: true,\r\n        },\r\n        {\r\n          text: \"Текст\",\r\n          align: \"start\",\r\n          sortable: false,\r\n          value: \"text\",\r\n          divider: true,\r\n        },\r\n      ],\r\n      messageList: [],\r\n      rowsCount: 0,\r\n      rowsPerPage: 25,\r\n      options: { mustSort: true },\r\n      loading: false,\r\n    };\r\n  },\r\n  computed: {\r\n    tableHeight() {\r\n      if (this.toolBarHeight !== undefined)\r\n        return this.windowHeight - this.toolBarHeight - 59;\r\n      return undefined;\r\n    },\r\n    isXS() {\r\n      return this.$vuetify.breakpoint.xs;\r\n    },\r\n\r\n    createMessagePath() {\r\n      return (\r\n        \"/create-message/\" +\r\n        this.paging(this.pageNumber, this.sortColumn, this.descendingOrder)\r\n      );\r\n    },\r\n\r\n    pageCount() {\r\n      if (this.rowsCount > 0)\r\n        return Math.ceil(this.rowsCount / this.rowsPerPage);\r\n      else return 1;\r\n    },\r\n\r\n    isDescendingOrder() {\r\n      return this.descendingOrder == \"true\"\r\n        ? true\r\n        : this.descendingOrder == \"false\"\r\n        ? false\r\n        : undefined;\r\n    },\r\n  },\r\n  methods: {\r\n    handleWindowResize() {\r\n      this.windowHeight = window.innerHeight;\r\n    },\r\n    paging(pageNumber, sortColumn, descendingOrder) {\r\n      return pageNumber + \"&\" + sortColumn + \"&\" + descendingOrder;\r\n    },\r\n\r\n    localeDateTimeString(date) {\r\n      return new Date(date).toLocaleString();\r\n    },\r\n\r\n    loadMessageList() {\r\n      let options = {\r\n        PageNumber: Number(this.pageNumber),\r\n        PageSize: this.rowsPerPage,\r\n        SortColumn: this.sortColumn,\r\n        DescendingOrder: this.isDescendingOrder,\r\n      };\r\n\r\n      this.loading = true;\r\n      this.$store\r\n        .dispatch(\"messages/getMessages\", options)\r\n        .then((responce) => {\r\n          this.loading = false;\r\n          this.messageList = responce.data.messageList;\r\n          this.rowsCount = responce.data.rowsCount;\r\n          this.options.page = options.PageNumber;\r\n          this.page = options.PageNumber;\r\n          this.options.sortBy = [options.SortColumn];\r\n          this.options.sortDesc = [options.DescendingOrder];\r\n        })\r\n        .catch(() => {\r\n          this.loading = false;\r\n        });\r\n    },\r\n\r\n    pageClicked(page) {\r\n      if (this.page !== page) {\r\n        this.$router\r\n          .push(\r\n            \"/messages/\" +\r\n              this.paging(page, this.sortColumn, this.descendingOrder)\r\n          )\r\n          .then(() => {\r\n            this.loadMessageList();\r\n          })\r\n          .catch(() => {});\r\n      }\r\n    },\r\n  },\r\n  watch: {\r\n    options: function () {\r\n      if (\r\n        this.options.sortBy[0] &&\r\n        this.options.sortDesc[0] !== undefined &&\r\n        (this.options.sortBy[0] !== this.sortColumn ||\r\n          this.options.sortDesc[0] !== this.isDescendingOrder)\r\n      ) {\r\n        this.$router\r\n          .push(\r\n            \"/messages/\" +\r\n              this.paging(1, this.options.sortBy[0], this.options.sortDesc[0])\r\n          )\r\n          .then(() => {\r\n            this.loadMessageList();\r\n          })\r\n          .catch(() => {});\r\n      }\r\n    },\r\n  },\r\n  destroyed() {\r\n    window.removeEventListener(\"resize\", this.handleWindowResize);\r\n  },\r\n  mounted() {\r\n    window.addEventListener(\"resize\", this.handleWindowResize);\r\n    this.handleWindowResize();\r\n    this.toolBarHeight = this.$refs.msgListToolbar.computedContentHeight;\r\n\r\n    if (\r\n      !Number.isSafeInteger(Number(this.pageNumber)) ||\r\n      !this.headers.find((item) => item.value === this.sortColumn) ||\r\n      this.isDescendingOrder === undefined\r\n    ) {\r\n      this.$router\r\n        .push(\"/messages/\" + this.paging(1, \"userName\", false))\r\n        .then(() => {\r\n          this.loadMessageList();\r\n        })\r\n        .catch(() => {});\r\n    } else this.loadMessageList();\r\n  },\r\n};\r\n</script>"]}]}